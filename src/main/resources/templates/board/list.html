<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>자유 게시판</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/css/styles.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body id="page-top">

<!-- Navigation -->
<navclass="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
    <div class="container">
        <a class="navbar-brand" th:href="${user} != null ? '/loginhome' : '/'">MM Community</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarResponsive"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/members/login">로그인</a></li>
                <li class="nav-item"><a class="nav-link" href="/members/join">회원가입</a></li>
            </ul>
        </div>
    </div>
</nav>

<header class="masthead mt-5 pt-5">
    <div class="container mt-5">
        <h2 class="text-center">자유 게시판</h2>

        <!-- 검색 -->
        <form id="searchForm" class="input-group mb-3 w-50 mx-auto">
            <input type="text" name="keyword" id="keyword" class="form-control" placeholder="제목으로 검색" />
            <button class="btn btn-outline-secondary" type="submit">검색</button>
        </form>

        <div class="text-end mb-3">
            <a class="btn btn-primary" th:href="@{/board/create}">글쓰기</a>
        </div>

        <!-- 게시판 결과 영역 -->
        <div id="board-result" th:fragment="boardTable">
            <table class="table table-striped table-hover">
                <thead class="table-light">
                <tr>
                    <th scope="col">번호</th>
                    <th scope="col">제목</th>
                    <th scope="col">작성일</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="board : ${boardPage.content}">
                    <td th:text="${board.boardId}"></td>
                    <td>
                        <a th:href="@{'/board/' + ${board.boardId}}" th:text="${board.title}"></a>
                    </td>
                    <td th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd')}"></td>
                </tr>
                </tbody>
            </table>

            <!-- 페이징 -->
            <nav th:if="${boardPage.totalPages > 1}">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${!boardPage.hasPrevious()} ? 'disabled'">
                        <a class="page-link" href="#" th:onclick="'loadSearchPage(' + (${boardPage.number} - 1) + ')'">이전</a>
                    </li>

                    <li class="page-item" th:each="i : ${#numbers.sequence(0, boardPage.totalPages - 1)}"
                        th:classappend="${boardPage.number == i} ? 'active'">
                        <a class="page-link" href="#" th:onclick="'loadSearchPage(' + ${i} + ')'" th:text="${i + 1}">1</a>
                    </li>

                    <li class="page-item" th:classappend="${!boardPage.hasNext()} ? 'disabled'">
                        <a class="page-link" href="#" th:onclick="'loadSearchPage(' + (${boardPage.number} + 1) + ')'">다음</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>

<!-- Footer -->
<footer class="bg-light py-4 mt-5">
    <div class="container text-center small text-muted">Copyright &copy; 2025 - Kernel360 Team Pose</div>
</footer>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('searchForm').addEventListener('submit', function (e) {
        e.preventDefault();
        loadSearchPage(0);
    });

    function loadSearchPage(page) {
        const keyword = document.getElementById('keyword').value;
        fetch(`/board/search?keyword=${encodeURIComponent(keyword)}&page=${page}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById('board-result').innerHTML = html;
            });
    }
</script>

</body>
</html>
